<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="referrer" content="strict-origin-when-cross-origin"/>
<title>SHANTAJ — Demo Player</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<!-- HLViewer CSS (you confirmed it's hlviewer.css) -->
<link rel="stylesheet" href="hlviewer/hlviewer.css">

<style>
  :root{
    --bg:#ffffff;
    --text:#111;
    --card:rgba(255,255,255,0.6);
    --border:rgba(0,0,0,0.08);
    --accent:#111;
  }
  body.dark{
    --bg:#0a0a0a;
    --text:#fff;
    --card:rgba(255,255,255,0.05);
    --border:rgba(255,255,255,0.08);
    --accent:#fff;
  }

  *{box-sizing:border-box;}
  html,body{height:100%;}
  body{
    margin:0;
    font-family:'Inter',sans-serif;
    background:var(--bg);
    color:var(--text);
    overflow:hidden; /* keep contained */
  }

  /* NAV (same style) */
  nav{
    position:fixed;top:0;left:0;right:0;
    backdrop-filter:blur(10px);
    background:rgba(255,255,255,0.6);
    border-bottom:1px solid var(--border);
    z-index:1000;
  }
  body.dark nav{background:rgba(0,0,0,0.6)}
  .nav-inner{
    max-width:1100px;margin:0 auto;
    padding:14px 20px;  /* slightly shorter = more vertical space */
    display:flex;align-items:center;position:relative;
  }
  .nav-links{margin:0 auto;display:flex;gap:30px;align-items:center;justify-content:center;}
  .nav-links a{
    text-decoration:none;font-weight:800;color:var(--text);
    letter-spacing:.5px;text-transform:uppercase;position:relative;
  }
  .nav-links a::after{
    content:"";position:absolute;left:0;bottom:-6px;height:2px;width:0;background:var(--accent);transition:.25s ease;
  }
  .nav-links a:hover::after{width:100%;}

  .toggle{position:absolute;right:20px;width:50px;height:26px}
  .toggle input{display:none}
  .slider{position:absolute;inset:0;background:#ccc;border-radius:50px;transition:.25s;outline:1px solid var(--border);}
  .slider:before{content:"";position:absolute;height:20px;width:20px;left:3px;bottom:3px;background:#fff;border-radius:50%;transition:.25s}
  input:checked + .slider{background:var(--accent)}
  input:checked + .slider:before{transform:translateX(24px);background:var(--bg)}

  /* Layout */
  .shell{
    position:fixed;
    inset:0;
    padding-top:58px; /* nav height */
    display:flex;
    flex-direction:column;
    min-height:0;
  }

  .topbar{
    flex:0 0 auto;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    padding:10px 14px; /* shorter */
    border-bottom:1px solid var(--border);
    background:rgba(255,255,255,0.55);
    backdrop-filter:blur(10px);
  }
  body.dark .topbar{background:rgba(0,0,0,0.35);}

  .left{
    display:flex;
    gap:12px;
    align-items:center;
    min-width:0;
  }
  .titlewrap{display:flex;flex-direction:column;min-width:0;}
  .pt-title{
    font-weight:900;
    letter-spacing:.4px;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
    max-width:min(720px, 62vw);
    line-height:1.1;
  }
  .pt-sub{
    opacity:.75;
    font-weight:700;
    font-size:.85rem;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
    max-width:min(720px, 62vw);
    line-height:1.1;
  }

  .btn{
    border:1px solid var(--border);
    background:transparent;
    color:var(--text);
    padding:10px 14px;
    border-radius:999px;
    font-weight:900;
    letter-spacing:.4px;
    text-transform:uppercase;
    font-size:.75rem;
    transition:.15s;
    cursor:pointer;
  }
  .btn:hover{transform:scale(1.03); background:rgba(0,0,0,0.04);}
  body.dark .btn:hover{background:rgba(255,255,255,0.07);}

  /* Viewer area */
  .viewerArea{
    flex:1 1 auto;
    min-height:0;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:16px;
  }

  /* 16:9 but not ultra-wide */
  .stage{
    width:min(1200px, 96vw); /* limit width so it feels less “wide” */
    aspect-ratio:16/9;
    max-height:calc(100vh - 58px - 54px - 32px); /* nav - topbar - padding */
    border:1px solid var(--border);
    border-radius:22px;
    overflow:hidden;
    background:transparent;
    position:relative;
  }

  /* HLViewer target must have explicit size */
  #hlvTarget{
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
    overflow:hidden;
  }

  /* Optional: show an error overlay */
  .overlay{
    position:absolute; inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:18px;
    text-align:center;
    font-weight:800;
    background:transparent;
    pointer-events:none;
  }
  .overlay.hidden{display:none;}
</style>
</head>

<body>
<nav>
  <div class="nav-inner">
    <div class="nav-links">
      <a href="index.html">HOME</a>
      <a href="index.html#vip">VIP</a>
      <a href="news.html">NEWS</a>
    </div>
    <label class="toggle" aria-label="Toggle dark mode">
      <input type="checkbox" id="themeToggle">
      <span class="slider"></span>
    </label>
  </div>
</nav>

<div class="shell">
  <div class="topbar">
    <div class="left">
      <button class="btn" id="backBtn" type="button">Back</button>
      <div class="titlewrap">
        <div class="pt-title" id="playerTitle">HLViewer</div>
        <div class="pt-sub" id="playerSub">Loading…</div>
      </div>
    </div>
    <div style="display:flex;gap:10px;align-items:center;">
      <button class="btn" id="fitBtn" type="button">Fit</button>
    </div>
  </div>

  <div class="viewerArea">
    <div class="stage" id="stage">
      <div id="hlvTarget"></div>
      <div class="overlay hidden" id="errOverlay"></div>
    </div>
  </div>
</div>

<!-- HLViewer JS (GLOBAL) -->
<script src="hlviewer/hlviewer.min.js"></script>

<script>
  // Theme
  const themeToggle = document.getElementById('themeToggle');
  if (localStorage.getItem('theme') === 'dark') {
    document.body.classList.add('dark');
    themeToggle.checked = true;
  }
  themeToggle.addEventListener('change', () => {
    document.body.classList.toggle('dark');
    localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
    location.reload();
  });

  // Back
  document.getElementById('backBtn').addEventListener('click', () => {
    if (history.length > 1) history.back();
    else location.href = "maps.html";
  });

  const titleEl = document.getElementById('playerTitle');
  const subEl   = document.getElementById('playerSub');
  const fitBtn  = document.getElementById('fitBtn');
  const errOverlay = document.getElementById('errOverlay');

  const qs = new URLSearchParams(location.search);
  const demoFile = qs.get('demo') || qs.get('replay'); // allow both
  const mapFile  = qs.get('map');
  const prettyTitle = qs.get('title') || (demoFile || mapFile || 'HLViewer');
  const fileToLoad = demoFile || mapFile;

  titleEl.textContent = prettyTitle;
  subEl.textContent = demoFile ? `Demo: ${demoFile}` : (mapFile ? `Map: ${mapFile}` : `Missing ?demo=... or ?map=...`);

  function showError(msg){
    errOverlay.textContent = msg;
    errOverlay.classList.remove('hidden');
    subEl.textContent = 'Error';
  }

  // Ensure HLViewer loaded
  if (!window.HLViewer || typeof window.HLViewer.init !== 'function') {
    showError("HLViewer did not load. Check: hlviewer/hlviewer.min.js (filename/path).");
  } else if (!fileToLoad) {
    showError("No file specified. Use: player.html?demo=YOUR.dem or player.html?map=YOUR.bsp");
  } else {
    // Init using README-style options
    const hlv = window.HLViewer.init('#hlvTarget', {
      paths: {
        base:    './',
        replays: 'res/replays',
        maps:    'res/maps',
        wads:    'res/wads',
        skies:   'res/skies',
        sounds:  'res/sounds'
      }
    });

    try{
      hlv.load(fileToLoad);
      subEl.textContent = demoFile ? `Playing: ${demoFile}` : `Loading: ${mapFile}`;
    }catch(e){
      console.error(e);
      showError("HLViewer init/load crashed. Open console (F12) and paste the error.");
    }

    // Fit just forces a resize/layout reflow (HLViewer reads element size)
    function forceFit(){
      const t = document.getElementById('hlvTarget');
      t.style.width = '100%';
      t.style.height = '100%';
      // no official resize API documented; this still helps the viewer measure correctly
    }
    fitBtn.addEventListener('click', forceFit);
    window.addEventListener('resize', forceFit);
    setTimeout(forceFit, 50);
    setTimeout(forceFit, 250);
  }
</script>
</body>
</html>
